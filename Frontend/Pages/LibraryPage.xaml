<Page x:Class="Tune.Frontend.Pages.LibraryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="LibraryPage"
    Background="#2E2E2E">

  <Page.Resources>
    <!-- Copy styles from MainPage for header/footer consistency -->
    <Style x:Key="FooterMusicButtonStyle" TargetType="Button">
      <Setter Property="Background" Value="#23272F"/>
      <Setter Property="BorderBrush" Value="transparent"/>
      <Setter Property="BorderThickness" Value="1.2"/>
      <Setter Property="Width" Value="50"/>
      <Setter Property="Height" Value="50"/>
      <Setter Property="Padding" Value="0"/>
      <Setter Property="Margin" Value="8,0,8,0"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="45"
                Width="{TemplateBinding Width}"
                Height="{TemplateBinding Height}">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="#2E2E2E"/>
                <Setter Property="BorderBrush" Value="transparent"/>
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter Property="Background" Value="#1A1A1A"/>
                <Setter Property="BorderBrush" Value="#8AF3FF"/>
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    <Style x:Key="PopupButtonStyle" TargetType="Button">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="Padding" Value="8,4"/>
      <Setter Property="Margin" Value="0,0,0,4"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" CornerRadius="4">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="#3A3A3A"/>
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter Property="Background" Value="#555555"/>
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    <Style x:Key="PopupButtonStyleLogout" TargetType="Button">
      <Setter Property="Background" Value="#8b0000"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="Padding" Value="8,4"/>
      <Setter Property="Margin" Value="0,0,0,4"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" CornerRadius="4">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="#3A3A3A"/>
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter Property="Background" Value="#555555"/>
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    <Style x:Key="HeaderButtons" TargetType="Button">
      <Setter Property="Background" Value="#23272F"/>
      <Setter Property="Foreground" Value="#8AF3FF"/>
      <Setter Property="BorderBrush" Value="#8AF3FF"/>
      <Setter Property="BorderThickness" Value="1.2"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="FontSize" Value="16"/>
      <Setter Property="Width" Value="56"/>
      <Setter Property="Height" Value="56"/>
      <Setter Property="Padding" Value="8"/>
      <Setter Property="Margin" Value="8,0,0,0"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="12"
                Width="{TemplateBinding Width}"
                Height="{TemplateBinding Height}">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="#2E2E2E"/>
                <Setter Property="Foreground" Value="#B2F7FF"/>
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter Property="Background" Value="#1A1A1A"/>
                <Setter Property="Foreground" Value="#8AF3FF"/>
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    <Style x:Key="TitleTextStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="28"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Foreground" Value="#8AF3FF"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
      <Setter Property="Margin" Value="0,24,0,12"/>
    </Style>
    <Style x:Key="InfoTextStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="18"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="Opacity" Value="0.85"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
      <Setter Property="Margin" Value="0,6"/>
    </Style>
  </Page.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- HEADER -->
    <Border Grid.Row="0" Height="88" CornerRadius="0,0,6,6" Margin="0,0,0,0" Padding="0" Background="#23272F">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Button Style="{StaticResource HeaderButtons}" Click="LogoButton_Click">
          <Image Source="../imgs/Logo.png" Stretch="Uniform" Width="28" Height="28"/>
        </Button>
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left" Grid.Column="1" Margin="24,0,0,0">
          <Button Style="{StaticResource HeaderButtons}" Click="LibraryButton_Click">
            <Image Source="../imgs/Library.png"/>
          </Button>
          <Button Style="{StaticResource HeaderButtons}" Click="UploadButton_Click">
            <Image Source="../imgs/Upload.png"/>
          </Button>
        </StackPanel>
        <Border Grid.Column="2" Background="#23272F" CornerRadius="6" Padding="12,6" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,24,0">
          <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <TextBlock Text="Logged in as: " Foreground="#8AF3FF" FontWeight="Bold" FontSize="16" VerticalAlignment="Center"/>
            <TextBlock x:Name="UsernameDisplay" Foreground="White" FontWeight="SemiBold" FontSize="16" VerticalAlignment="Center" Margin="8,0,0,0"/>
            <!-- Profile Button -->
            <Button x:Name="ProfileMenuButton" Width="28" Height="28" Margin="10,0,0,0" Padding="0" Background="Transparent" BorderBrush="Transparent" BorderThickness="0" Cursor="Hand" Click="ProfileMenuButton_Click">
              <Button.Template>
                <ControlTemplate TargetType="Button">
                  <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </ControlTemplate>
              </Button.Template>
              <Viewbox Width="20" Height="20">
                <Canvas Width="24" Height="24">
                  <Ellipse Width="20" Height="20" Canvas.Left="2" Canvas.Top="2" Stroke="#8AF3FF" StrokeThickness="2"/>
                  <Ellipse Width="8" Height="8" Canvas.Left="8" Canvas.Top="6" Fill="#8AF3FF"/>
                  <Path Data="M6,18 Q12,14 18,18" Stroke="#8AF3FF" StrokeThickness="2" Fill="Transparent"/>
                </Canvas>
              </Viewbox>
            </Button>
            <!-- Dropdown Popup -->
            <Popup x:Name="ProfileMenuPopup" PlacementTarget="{Binding ElementName=ProfileMenuButton}" Placement="Bottom" StaysOpen="False" AllowsTransparency="True" PopupAnimation="Fade">
              <Border Background="#23272F" CornerRadius="8" Padding="16" SnapsToDevicePixels="True" MinWidth="160">
                <StackPanel>
                  <Button Content="Profile" Style="{StaticResource PopupButtonStyle}" Click="ProfileButton_Click" FontSize="16" Padding="12,6" Height="36"/>
                  <Button Content="Logout" Style="{StaticResource PopupButtonStyleLogout}" Click="LogoutButton_Click" FontSize="16" Padding="12,6" Height="36"/>
                </StackPanel>
              </Border>
            </Popup>
          </StackPanel>
        </Border>
      </Grid>
    </Border>

    <!-- MAIN CONTENT -->
    <StackPanel Grid.Row="1" VerticalAlignment="Top" HorizontalAlignment="Center">
      <TextBlock Text="Library" Style="{StaticResource TitleTextStyle}"/>
      <TextBlock Text="Check the main page to manage your songs" Style="{StaticResource InfoTextStyle}" Margin="0,24,0,0"/>
    </StackPanel>

    <!-- FOOTER (Music Controls) -->
    <Border Grid.Row="2" Height="64" CornerRadius="6,6,0,0" Margin="0,0,0,0" Padding="0" Background="#23272F">
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0">
        <Button Style="{StaticResource FooterMusicButtonStyle}">
          <Image Source="../imgs/goback.png" Stretch="Uniform" Width="28" Height="28"/>
        </Button>
        <Button Style="{StaticResource FooterMusicButtonStyle}">
          <Image Source="../imgs/play.png" Stretch="Uniform" Width="28" Height="28"/>
        </Button>
        <Button Style="{StaticResource FooterMusicButtonStyle}">
          <Image Source="../imgs/skip.png" Stretch="Uniform" Width="28" Height="28"/>
        </Button>
      </StackPanel>
    </Border>
  </Grid>
</Page>